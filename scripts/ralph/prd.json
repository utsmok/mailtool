{
  "projectName": "Mailtool MCP SDK v2 Migration",
  "branchName": "feature/mcp-sdk-v2-migration",
  "description": "Migrate from hand-rolled MCP implementation to official MCP Python SDK v2 using FastMCP framework",
  "version": "2.3.0",
  "userStories": [
    {
      "id": "US-001",
      "title": "Set up MCP SDK infrastructure",
      "description": "Add mcp>=0.9.0 dependency to pyproject.toml, create src/mailtool/mcp/ package structure with __init__.py, server.py, models.py, resources.py, lifespan.py",
      "priority": 1,
      "passes": true,
      "phase": 1
    },
    {
      "id": "US-002",
      "title": "Implement lifespan management",
      "description": "Create OutlookContext dataclass with bridge attribute, implement outlook_lifespan() async context manager with @asynccontextmanager decorator, add bridge creation via thread pool executor for COM safety, implement warmup with 5 retry attempts, add cleanup logic to release COM objects",
      "priority": 2,
      "passes": true,
      "phase": 1
    },
    {
      "id": "US-003",
      "title": "Create FastMCP server skeleton",
      "description": "Create FastMCP server instance with name 'mailtool-outlook-bridge', attach outlook_lifespan to server for COM bridge lifecycle management, add basic if __name__ == '__main__' block calling mcp.run(transport='stdio')",
      "priority": 3,
      "passes": true,
      "phase": 1
    },
    {
      "id": "US-004",
      "title": "Define email Pydantic models",
      "description": "Implement EmailSummary model with 7 fields (entry_id, subject, sender, sender_name, received_time, unread, has_attachments), implement EmailDetails model extending EmailSummary with body, html_body (9 fields total), implement SendEmailResult model for send/draft operations",
      "priority": 4,
      "passes": true,
      "phase": 2
    },
    {
      "id": "US-005",
      "title": "Define calendar Pydantic models",
      "description": "Implement AppointmentSummary model with 12 fields (entry_id, subject, start, end, location, organizer, all_day, required_attendees, optional_attendees, response_status, meeting_status, response_requested), implement AppointmentDetails model extending AppointmentSummary with body field, implement CreateAppointmentResult and FreeBusyInfo models",
      "priority": 5,
      "passes": true,
      "phase": 2
    },
    {
      "id": "US-006",
      "title": "Define task Pydantic models",
      "description": "Implement TaskSummary model with 9 fields (entry_id, subject, body, due_date, status, priority, complete, percent_complete), implement CreateTaskResult model, implement OperationResult model for generic boolean operations",
      "priority": 6,
      "passes": true,
      "phase": 2
    },
    {
      "id": "US-007",
      "title": "Write Pydantic model tests",
      "description": "Create tests/mcp/test_models.py with validation tests for all models (EmailSummary, EmailDetails, SendEmailResult, AppointmentSummary, AppointmentDetails, CreateAppointmentResult, FreeBusyInfo, TaskSummary, CreateTaskResult, OperationResult)",
      "priority": 7,
      "passes": true,
      "phase": 2
    },
    {
      "id": "US-008",
      "title": "Implement get_email tool",
      "description": "Migrate get_email tool to use FastMCP @mcp.tool() decorator, return EmailDetails model, handle bridge.get_email_body() call, raise McpError if email not found",
      "priority": 8,
      "passes": true,
      "phase": 3
    },
    {
      "id": "US-009",
      "title": "Implement get_appointment tool",
      "description": "Migrate get_appointment tool to use FastMCP @mcp.tool() decorator, return AppointmentDetails model, handle bridge.get_appointment_body() call, raise McpError if appointment not found",
      "priority": 9,
      "passes": true,
      "phase": 3
    },
    {
      "id": "US-010",
      "title": "Implement get_task tool",
      "description": "Migrate get_task tool to use FastMCP @mcp.tool() decorator, return TaskSummary model, handle bridge.get_task_body() call, raise McpError if task not found",
      "priority": 10,
      "passes": true,
      "phase": 3
    },
    {
      "id": "US-011",
      "title": "Implement mark_email tool",
      "description": "Migrate mark_email tool to use FastMCP @mcp.tool() decorator, return OperationResult model, handle bridge.mark_email_read() call with unread parameter",
      "priority": 11,
      "passes": true,
      "phase": 3
    },
    {
      "id": "US-012",
      "title": "Implement complete_task tool",
      "description": "Migrate complete_task tool to use FastMCP @mcp.tool() decorator, return OperationResult model, handle bridge.complete_task() call",
      "priority": 12,
      "passes": true,
      "phase": 3
    },
    {
      "id": "US-013",
      "title": "Implement delete_email tool",
      "description": "Migrate delete_email tool to use FastMCP @mcp.tool() decorator, return OperationResult model, handle bridge.delete_email() call",
      "priority": 13,
      "passes": true,
      "phase": 3
    },
    {
      "id": "US-014",
      "title": "Implement delete_appointment tool",
      "description": "Migrate delete_appointment tool to use FastMCP @mcp.tool() decorator, return OperationResult model, handle bridge.delete_appointment() call",
      "priority": 14,
      "passes": true,
      "phase": 3
    },
    {
      "id": "US-015",
      "title": "Implement delete_task tool",
      "description": "Migrate delete_task tool to use FastMCP @mcp.tool() decorator, return OperationResult model, handle bridge.delete_task() call",
      "priority": 15,
      "passes": true,
      "phase": 3
    },
    {
      "id": "US-016",
      "title": "Implement list_emails tool",
      "description": "Migrate list_emails tool to use FastMCP @mcp.tool() decorator, return list[EmailSummary], handle limit and folder parameters, convert bridge list_emails() output to models",
      "priority": 16,
      "passes": true,
      "phase": 4
    },
    {
      "id": "US-017",
      "title": "Implement send_email tool",
      "description": "Migrate send_email tool to use FastMCP @mcp.tool() decorator, return SendEmailResult model, handle to, subject, body, cc, bcc, html_body, file_paths, save_draft parameters, handle three return types (False, True, EntryID string)",
      "priority": 17,
      "passes": true,
      "phase": 4
    },
    {
      "id": "US-018",
      "title": "Implement reply_email tool",
      "description": "Migrate reply_email tool to use FastMCP @mcp.tool() decorator, return OperationResult model, handle entry_id, body, reply_all parameters",
      "priority": 18,
      "passes": true,
      "phase": 4
    },
    {
      "id": "US-019",
      "title": "Implement forward_email tool",
      "description": "Migrate forward_email tool to use FastMCP @mcp.tool() decorator, return OperationResult model, handle entry_id, to, cc, bcc parameters",
      "priority": 19,
      "passes": true,
      "phase": 4
    },
    {
      "id": "US-020",
      "title": "Implement move_email tool",
      "description": "Migrate move_email tool to use FastMCP @mcp.tool() decorator, return OperationResult model, handle entry_id and folder parameters",
      "priority": 20,
      "passes": true,
      "phase": 4
    },
    {
      "id": "US-021",
      "title": "Implement search_emails tool",
      "description": "Migrate search_emails tool to use FastMCP @mcp.tool() decorator, return list[EmailSummary], handle filter_query and limit parameters",
      "priority": 21,
      "passes": true,
      "phase": 4
    },
    {
      "id": "US-022",
      "title": "Implement email resources",
      "description": "Create register_email_resources() function in resources.py, register inbox://emails, inbox://unread, and email://{entry_id} resources using @mcp.resource() decorator",
      "priority": 22,
      "passes": true,
      "phase": 4
    },
    {
      "id": "US-023",
      "title": "Implement list_calendar_events tool",
      "description": "Migrate list_calendar_events tool to use FastMCP @mcp.tool() decorator, return list[AppointmentSummary], handle days and all parameters",
      "priority": 23,
      "passes": true,
      "phase": 5
    },
    {
      "id": "US-024",
      "title": "Implement create_appointment tool",
      "description": "Migrate create_appointment tool to use FastMCP @mcp.tool() decorator, return CreateAppointmentResult model, handle subject, start, end, location, body, all_day, required_attendees, optional_attendees parameters",
      "priority": 24,
      "passes": true,
      "phase": 5
    },
    {
      "id": "US-025",
      "title": "Implement edit_appointment tool",
      "description": "Migrate edit_appointment tool to use FastMCP @mcp.tool() decorator, return OperationResult model, handle entry_id and all optional appointment parameters",
      "priority": 25,
      "passes": true,
      "phase": 5
    },
    {
      "id": "US-026",
      "title": "Implement respond_to_meeting tool",
      "description": "Migrate respond_to_meeting tool to use FastMCP @mcp.tool() decorator, return OperationResult model, handle entry_id and response parameter (accept/decline/tentative)",
      "priority": 26,
      "passes": true,
      "phase": 5
    },
    {
      "id": "US-027",
      "title": "Implement get_free_busy tool",
      "description": "Migrate get_free_busy tool to use FastMCP @mcp.tool() decorator, return FreeBusyInfo model, handle email_address, start_date, end_date parameters",
      "priority": 27,
      "passes": true,
      "phase": 5
    },
    {
      "id": "US-028",
      "title": "Implement calendar resources",
      "description": "Create register_calendar_resources() function in resources.py, register calendar://today and calendar://week resources using @mcp.resource() decorator",
      "priority": 28,
      "passes": true,
      "phase": 5
    },
    {
      "id": "US-029",
      "title": "Implement list_tasks tool",
      "description": "Migrate list_tasks tool to use FastMCP @mcp.tool() decorator, return list[TaskSummary], handle include_completed parameter (default False)",
      "priority": 29,
      "passes": true,
      "phase": 5
    },
    {
      "id": "US-030",
      "title": "Implement list_all_tasks tool",
      "description": "Migrate list_all_tasks tool to use FastMCP @mcp.tool() decorator, return list[TaskSummary], calls bridge.list_tasks(include_completed=True)",
      "priority": 30,
      "passes": true,
      "phase": 5
    },
    {
      "id": "US-031",
      "title": "Implement create_task tool",
      "description": "Migrate create_task tool to use FastMCP @mcp.tool() decorator, return CreateTaskResult model, handle subject, body, due_date, priority parameters",
      "priority": 31,
      "passes": true,
      "phase": 5
    },
    {
      "id": "US-032",
      "title": "Implement edit_task tool",
      "description": "Migrate edit_task tool to use FastMCP @mcp.tool() decorator, return OperationResult model, handle entry_id and all optional task parameters",
      "priority": 32,
      "passes": true,
      "phase": 5
    },
    {
      "id": "US-033",
      "title": "Implement task resources",
      "description": "Create register_task_resources() function in resources.py, register tasks://active and tasks://all resources using @mcp.resource() decorator",
      "priority": 33,
      "passes": true,
      "phase": 5
    },
    {
      "id": "US-034",
      "title": "Write tool tests",
      "description": "Create tests/mcp/test_tools.py with comprehensive tests for all 23 tools using SDK client session and stdio transport",
      "priority": 34,
      "passes": true,
      "phase": 6
    },
    {
      "id": "US-035",
      "title": "Write resource tests",
      "description": "Create tests/mcp/test_resources.py with tests for all resources (email, calendar, task) using SDK client session",
      "priority": 35,
      "passes": true,
      "phase": 6
    },
    {
      "id": "US-036",
      "title": "Write integration tests",
      "description": "Create tests/mcp/test_integration.py with end-to-end workflow tests for complete email, calendar, and task operations",
      "priority": 36,
      "passes": true,
      "phase": 6
    },
    {
      "id": "US-037",
      "title": "Create custom exception classes",
      "description": "Create src/mailtool/mcp/exceptions.py with OutlookNotFoundError, OutlookComError, OutlookValidationError classes extending McpError",
      "priority": 37,
      "passes": true,
      "phase": 6
    },
    {
      "id": "US-038",
      "title": "Add logging to MCP server",
      "description": "Add proper logging configuration to src/mailtool/mcp/server.py with error logging for debugging and monitoring",
      "priority": 38,
      "passes": true,
      "phase": 6
    },
    {
      "id": "US-039",
      "title": "Update README.md",
      "description": "Update README.md with new MCP Server section describing SDK v2 features, structured output, resources, type safety, and migration notes",
      "priority": 39,
      "passes": true,
      "phase": 6
    },
    {
      "id": "US-040",
      "title": "Update CLAUDE.md",
      "description": "Update CLAUDE.md with new architecture patterns, FastMCP decorator usage, model definitions, and updated development workflow",
      "priority": 40,
      "passes": true,
      "phase": 6
    },
    {
      "id": "US-041",
      "title": "Update MCP_INTEGRATION.md",
      "description": "Update MCP_INTEGRATION.md with SDK v2 patterns, tool catalog with return types, resource documentation, and usage examples",
      "priority": 41,
      "passes": true,
      "phase": 6
    },
    {
      "id": "US-042",
      "title": "Update plugin.json",
      "description": "Update .claude-plugin/plugin.json to point to new SDK server entry point (mailtool.mcp.server) and bump version to 2.3.0",
      "priority": 42,
      "passes": true,
      "phase": 6
    },
    {
      "id": "US-043",
      "title": "Update CI/CD workflow",
      "description": "Update .github/workflows/ci.yml to install mcp dependency and run MCP server tests",
      "priority": 43,
      "passes": true,
      "phase": 6
    },
    {
      "id": "US-044",
      "title": "Performance testing",
      "description": "Run performance benchmarks comparing old vs new implementation, test with large folders, verify COM object cleanup",
      "priority": 44,
      "passes": false,
      "phase": 6
    },
    {
      "id": "US-045",
      "title": "Memory leak testing",
      "description": "Run memory leak tests with repeated operations, verify COM objects are properly released, check garbage collection",
      "priority": 45,
      "passes": false,
      "phase": 6
    },
    {
      "id": "US-046",
      "title": "Manual Claude Code testing",
      "description": "Test all 23 tools manually with Claude Code, verify structured output, test error handling, validate resources",
      "priority": 46,
      "passes": false,
      "phase": 6
    },
    {
      "id": "US-047",
      "title": "Create rollback plan",
      "description": "Document rollback procedure in case of production issues, keep old mcp_server.py for 2 weeks, test rollback process",
      "priority": 47,
      "passes": false,
      "phase": 6
    },
    {
      "id": "US-048",
      "title": "Production deployment",
      "description": "Deploy to production Claude Code, monitor for issues, keep old version available for rollback",
      "priority": 48,
      "passes": false,
      "phase": 6
    },
    {
      "id": "US-049",
      "title": "Archive old implementation",
      "description": "After 2 weeks of successful production run, archive old mcp_server.py, update documentation to remove rollback notes",
      "priority": 49,
      "passes": false,
      "phase": 6
    },
    {
      "id": "US-050",
      "title": "Final validation and sign-off",
      "description": "Final validation checklist: all tests passing, all tools working, documentation complete, no known issues, ready for release",
      "priority": 50,
      "passes": false,
      "phase": 6
    }
  ]
}
